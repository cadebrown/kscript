#include <ks/impl.h>

double ksm_gamma(double x) {
    /* TODO: Reflection formulae? */

    /* Convert to internal type */
    double ix = x;

    /* Generated table */
    static int N = 23;
    static double c[23] = {

        2.50662827463100050241576528481104525301, 
        16814731711.08908306941321067845204193803, 
        -126915031550.3304006987237213879886112615, 
        433944942901.3039929352594070854027641777, 
        -889368020269.2714779825302244993633678543, 
        1218472425867.950982462407149425847396608, 
        -1178403473259.353582579235076134127954325, 
        828245531124.6278273747932784012133407144, 
        -429211287893.0626285425235274694167407406, 
        164698834727.6488847256809406666530573857, 
        -46615149219.89111195662960005277635087718, 
        9619972564.515443740003689745592466569999, 
        -1419382551.781042772917213600828817582525, 
        145414547.0816386138036320204333935011772, 
        -9923020.719435758163204479961299719844985, 
        425355.756391912757414894448025528181305, 
        -10533.71059784341947700868546707635687197, 
        133.2425479537961407613632859829685919305, 
        -0.7118343974029489336075479800275689383906, 
        0.001172051640057979517545052655493649395912, 
        -3.323940885824119180048125477862564493461e-07, 
        4.50380167440433883135784470588648299769e-12, 
        -5.320477002211632679495135130870304049791e-20, 

    };


    /* Now, compute sum */
    double acc = c[0];
    int k;
    for (k = 1; k < N; ++k) {
        acc += c[k] / (ix + k);
    }

    acc *= ksm_exp(N - ix) * ksm_pow(N + ix, ix + 0.5);

    return (double)(acc / ix);
}

